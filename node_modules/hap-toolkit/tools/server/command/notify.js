"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getDeviceInfo(e,t){var n=_http.default.request({path:"/deviceinfo",host:e.ip,port:e.port,timeout:3e3},function(e){e.on("data",function(e){t(null,JSON.parse(e))})}).on("error",function(e){t(e)}).on("timeout",function(){n.abort()});n.end()}function sendUpdateReq(e){var t="http://".concat(e.ip,":").concat(e.port,"/update"),n={host:e.ip,port:e.port,path:"/update",timeout:3e3},o=_http.default.request(n,function(e){console.log("### App Server ### 通知手机更新rpk文件成功: ".concat(t," "))}).on("error",function(e){console.log("### App Server ### 通知手机更新rpk文件失败(可忽略): ".concat(t," 错误信息: ").concat(e.message))}).on("timeout",function(){console.log("### App Server ### 通知手机更新rpk文件超时(可忽略): ".concat(t)),o.abort()});o.end()}var _http=_interopRequireDefault(require("http")),_fs=_interopRequireDefault(require("fs")),_conf=_interopRequireDefault(require("../lib/conf")),pathClientLog=_conf.default.defaults.pathClientLog,clientExists=!1;if(_fs.default.existsSync(pathClientLog)){var _JSON$parse=JSON.parse(_fs.default.readFileSync(pathClientLog).toString()),clients=_JSON$parse.clients;clients instanceof Array&&clients.length>0&&(clients.forEach(function(e){"127.0.0.1"!==e.ip?sendUpdateReq(e):getDeviceInfo(e,function(t){t||sendUpdateReq(e)})}),clientExists=!0)}clientExists||console.log("### App Server ### 没有记录手机地址，不会通知手机更新rpk文件");