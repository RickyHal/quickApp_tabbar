"use strict";function frameworkInit(){global.framework={module:{base:"system",ext:"service"},reservedFeatures:[],reservedFeatureExclude:[],supportInCard:[],project:{manifestFilePath:null,featureList:[],module:{usedBaseAll:!1,usedExtAll:!1}}},global.framework.reservedFeatures=global.framework.reservedFeatures.concat(["".concat(global.framework.module.base,".contact"),"".concat(global.framework.module.base,".webview"),"".concat(global.framework.module.base,".notification"),"".concat(global.framework.module.base,".media"),"".concat(global.framework.module.base,".file"),"".concat(global.framework.module.base,".storage"),"".concat(global.framework.module.base,".vibrator"),"".concat(global.framework.module.base,".calendar"),"".concat(global.framework.module.base,".shortcut"),"".concat(global.framework.module.base,".network"),"".concat(global.framework.module.base,".fetch"),"".concat(global.framework.module.base,".geolocation"),"".concat(global.framework.module.base,".request"),"".concat(global.framework.module.base,".share"),"".concat(global.framework.module.base,".clipboard"),"".concat(global.framework.module.base,".prompt"),"".concat(global.framework.module.base,".device"),"".concat(global.framework.module.base,".barcode"),"".concat(global.framework.module.base,".bluetooth"),"".concat(global.framework.module.base,".sensor"),"".concat(global.framework.module.base,".audio"),"".concat(global.framework.module.base,".package"),"".concat(global.framework.module.base,".volume"),"".concat(global.framework.module.base,".record"),"".concat(global.framework.module.base,".brightness"),"".concat(global.framework.module.base,".battery"),"".concat(global.framework.module.base,".image"),"".concat(global.framework.module.base,".cipher"),"".concat(global.framework.module.base,".sms"),"".concat(global.framework.module.base,".wifi"),"".concat(global.framework.module.base,".websocketfactory"),"".concat(global.framework.module.ext,".alipay"),"".concat(global.framework.module.ext,".push"),"".concat(global.framework.module.ext,".pay"),"".concat(global.framework.module.ext,".share"),"".concat(global.framework.module.ext,".wxpay"),"".concat(global.framework.module.ext,".stats"),"".concat(global.framework.module.ext,".account"),"".concat(global.framework.module.ext,".wxaccount"),"".concat(global.framework.module.ext,".qqaccount"),"".concat(global.framework.module.ext,".wbaccount")]),global.framework.reservedFeatureExclude.push("".concat(global.framework.module.base,".app")),global.framework.reservedFeatureExclude.push("".concat(global.framework.module.base,".model")),global.framework.reservedFeatureExclude.push("".concat(global.framework.module.base,".router")),global.framework.supportInCard=global.framework.supportInCard.concat(["".concat(global.framework.module.base,".share"),"".concat(global.framework.module.base,".prompt"),"".concat(global.framework.module.base,".vibrator"),"".concat(global.framework.module.base,".fetch"),"".concat(global.framework.module.base,".storage"),"".concat(global.framework.module.base,".clipboard"),"".concat(global.framework.module.base,".geolocation"),"".concat(global.framework.module.base,".network"),"".concat(global.framework.module.base,".device"),"".concat(global.framework.module.base,".battery"),"".concat(global.framework.module.base,".calendar"),"".concat(global.framework.module.base,".package"),"".concat(global.framework.module.base,".app"),"".concat(global.framework.module.base,".router")])}function searchModuleImport(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=[],r=new RegExp("['\"]@(".concat(global.framework.module.base,"|").concat(global.framework.module.ext,").*?['\"]"),"g"),l=new RegExp("['\"]@((".concat(global.framework.module.base,"|").concat(global.framework.module.ext,").*?)['\"]"));return(e.match(r)||[]).forEach(function(e){var r=(e.match(l)||[])[1];r==="@".concat(global.framework.module.base)?global.framework.project.module.usedBaseAll=!0:r==="@".concat(global.framework.module.ext)?global.framework.project.module.usedExtAll=!0:-1!==global.framework.reservedFeatures.indexOf(r)?-1===global.framework.project.featureList.indexOf(r)&&global.framework.project.featureList.push(r):o.uxType===_utils.UX_TYPE.CARD&&-1===global.framework.supportInCard.indexOf(r)?a.push({reason:"WARN: 您引入了卡片中未识别的native模块：".concat(r)}):-1!==global.framework.reservedFeatureExclude.indexOf(r)||a.push({reason:"WARN: 您引入了未识别的native模块：".concat(r)})}),{fileCont:e,logFeatureList:a}}function checkFeatureInCard(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(e).forEach(function(o){e[o].features.every(function(e){-1===global.framework.supportInCard.indexOf(e.name)&&_utils.colorconsole.error("WARN: manifest.json文件中引入了卡片".concat(o,"未识别的features：").concat(e.name))})})}function updateManifestCont(e,o){var a=null;try{a=JSON.parse(e)}catch(e){throw _utils.colorconsole.error("ERROR: 解析manifest.json文件出错：".concat(e.message)),e}if(a){a.config=a.config||{},a.config.debug=!o.sign,a.minPlatformVersion||(a.minPlatformVersion=101),a.features=a.features||[],checkFeatureInCard(a.router.widgets||{});var r=[].concat(global.framework.project.featureList);a.features.forEach(function(e){var o=r.indexOf(e.name);-1!==o&&r.splice(o,1)});var l=[];if(r.forEach(function(e){-1!==global.framework.reservedFeatures.indexOf(e)&&l.push(e)}),l.length>0){var t=l.map(function(e){return{name:e}});a.features=a.features.concat(t),_utils.colorconsole.warn("manifest.json文件中添加未声明的features: ".concat(l.join(", "),"\n"))}return e=JSON.stringify(a,null,2),{manifestCont:e}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.searchModuleImport=searchModuleImport,exports.updateManifestCont=updateManifestCont;var _utils=require("./utils");frameworkInit();