"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getProjectName(){try{var e=process.cwd(),t=_path.default.join(e,"src","manifest.json"),r=require(t);return r&&r.package||"Bundle"}catch(e){_utils.colorconsole.error("### App Server ### 获取项目名称出错：".concat(e.message))}}function recordClient(e,t){var r=_path.default.dirname(e),i={clients:[]};if(_fs.default.existsSync(r)){if(_fs.default.existsSync(e)&&(i=JSON.parse(_fs.default.readFileSync(e).toString()),i.clients instanceof Array))for(i.clients=i.clients.filter(function(e){return e.ip!==t.ip||e.port!==t.port});i.clients.length>4;)i.clients.shift()}else(0,_utils.mkdirsSync)(r);i.clients.push(t),_fs.default.writeFileSync(e,JSON.stringify(i))}function getServerAddress(e){return"http://".concat((0,_utils.getIPv4IPAddress)()).concat(80===e?"":":"+e)}function getRecordClient(e,t,r){if(_fs.default.existsSync(e)){var i=JSON.parse(_fs.default.readFileSync(e).toString()),s=i.clients;return s=s instanceof Array?s:[],s.find(function(e){return e.sn===t&&e.ip===r&&e.port})}}function getClientFromRequest(e){var t=(0,_utils.getClientIPAddress)(e),r=(0,_utils.getIPv4IPAddress)(),i=e.header["device-serial-number"],s=LINK_MODE.NULL;return"127.0.0.1"===t&&i?s=LINK_MODE.ADB:"127.0.0.1"!==t&&t!==r&&(s=LINK_MODE.WIFI),{clientIp:t,sn:i,linkMode:s}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getProjectName=getProjectName,exports.recordClient=recordClient,exports.getServerAddress=getServerAddress,exports.getClientFromRequest=getClientFromRequest,exports.getRecordClient=getRecordClient,exports.LINK_MODE=void 0;var _path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),_utils=require("../lib/utils"),LINK_MODE={NULL:0,WIFI:1,ADB:2};exports.LINK_MODE=LINK_MODE;