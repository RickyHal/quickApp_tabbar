"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function makeLoaderString(e,a,r){a=a||{};var t;return e===_utils.FRAG_TYPE.IMPORT?(t=[{name:defaultLoaders.component,query:{type:_utils.FRAG_TYPE.IMPORT}}],(0,_utils.stringifyLoaders)(t)):e===_utils.FRAG_TYPE.TEMPLATE?(t=[{name:defaultLoaders.json},{name:defaultLoaders.template}],a.alone||t.push({name:defaultLoaders.fragment,query:{index:0,type:_utils.FRAG_TYPE.TEMPLATE}}),(0,_utils.stringifyLoaders)(t)):e===_utils.FRAG_TYPE.STYLE?(t=[{name:defaultLoaders.json},{name:defaultLoaders.style,query:{index:0,type:_utils.FRAG_TYPE.STYLE}}],a.lang&&t.push({name:"".concat(a.lang,"-loader")}),a.alone||t.push({name:defaultLoaders.fragment,query:{index:0,type:_utils.FRAG_TYPE.STYLE}}),(0,_utils.stringifyLoaders)(t)):e===_utils.FRAG_TYPE.SCRIPT?(t=[{name:defaultLoaders.script},{name:defaultLoaders.module}],r===_utils.UX_TYPE.APP?t.push({name:defaultLoaders.mainfest,query:{path:a.path}},{name:defaultLoaders.babel,query:{comments:!1,babelrc:optionBabelrc}}):(t.push({name:defaultLoaders.babel,query:{plugins:[_path.default.resolve(loaderPath,"jsx-loader.js")],comments:!1,babelrc:optionBabelrc}}),(0,_utils.isUXRender)(r)&&t.push({name:defaultLoaders.access})),a.alone||t.push({name:defaultLoaders.fragment,query:{index:0,type:_utils.FRAG_TYPE.SCRIPT}}),(0,_utils.stringifyLoaders)(t)):void 0}function processImportFrag(e,a,r){var t="";if(a.length)for(var s=0;s<a.length;s++){var l=a[s],o=l.attrs.src,u=l.attrs.name;if(!o)return(0,_utils.logWarn)(e,[{reason:"导入组件需要设置属性 `src` "}]),"";if(!l.isValid)return e.emitError("导入组件resolve 出错 ".concat(l.err)),"";o=l.srcPath,u||(u=(0,_utils.getNameByPath)(o)),u=u.toLowerCase(),_validator.default.isReservedTag(u)&&(0,_utils.logWarn)(e,[{reason:"导入组件的属性 `name` 不能使用保留字: "+u}]),r.push(u),(0,_utils.print)({name:u,src:o});var n=(0,_utils.makeRequireString)(e,makeLoaderString(_utils.FRAG_TYPE.IMPORT),"".concat(o,"?uxType=").concat(_utils.UX_TYPE.COMP,"&name=").concat(u));t+=n}return t}function processTemplateFrag(e,a,r){var t="";if(a.length){var s=a[0],l=e.resourcePath,o=s.attrs.src;o&&(l=o),t="var $app_template$ = "+(0,_utils.makeRequireString)(e,makeLoaderString(_utils.FRAG_TYPE.TEMPLATE,{alone:!!o}),"".concat(l,"?uxType=").concat(r))}else(0,_utils.logWarn)(e,[{reason:"需要模板片段"}]);return t}function processStyleFrag(e,a,r){var t="";if(a.length){var s=a[0],l=e.resourcePath,o=s.attrs.src,u=s.attrs.lang;o&&(l=o),(0,_utils.print)({style:l}),t="var $app_style$ = "+(0,_utils.makeRequireString)(e,makeLoaderString(_utils.FRAG_TYPE.STYLE,{alone:!!o,lang:u}),"".concat(l,"?uxType=").concat(r))}return t}function processScriptFrag(e,a,r){var t="";if(a.length){var s=a[0],l=e.resourcePath,o=s.attrs.src;o&&(l=o),t="var $app_script$ = "+(0,_utils.makeRequireString)(e,makeLoaderString(_utils.FRAG_TYPE.SCRIPT,{alone:!!o,path:e.resourcePath},r),"".concat(l,"?uxType=").concat(r))}return t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.processImportFrag=processImportFrag,exports.processTemplateFrag=processTemplateFrag,exports.processStyleFrag=processStyleFrag,exports.processScriptFrag=processScriptFrag;var _path=_interopRequireDefault(require("path")),_validator=_interopRequireDefault(require("../../compiler/template/validator")),_utils=require("../../common/utils"),loaderPath=__dirname,defaultLoaders={component:_path.default.resolve(loaderPath,"ux-loader.js"),fragment:_path.default.resolve(loaderPath,"fragment-loader.js"),template:_path.default.resolve(loaderPath,"template-loader.js"),style:_path.default.resolve(loaderPath,"style-loader.js"),script:_path.default.resolve(loaderPath,"script-loader.js"),module:_path.default.resolve(loaderPath,"module-loader.js"),babel:(0,_utils.loadBabelModule)("babel-loader"),mainfest:_path.default.resolve(loaderPath,"manifest-loader.js"),access:_path.default.resolve(loaderPath,"access-loader.js"),json:_path.default.resolve(loaderPath,"json-loader.js")},optionBabelrc=process&&process.babelrc;