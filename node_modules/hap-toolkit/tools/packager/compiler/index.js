"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _formatFragment(e,t){var r,a,s,n,i={};if(t.__location){var o=t.__location;o.startTag&&o.endTag?(r=o.startTag.endOffset||0,a=o.endTag.startOffset||0):(r=o.startOffset||0,a=o.endOffset||0),s=o.line,n=o.col}else r=a=s=n=0;return t.attrs&&t.attrs.length&&t.attrs.forEach(function(e){i[e.name]=e.value}),{type:t.nodeName,attrs:i,content:e.substring(r,a),location:{start:r,end:a,line:s,column:n}}}function parseFragments(e){var t={import:[],template:[],style:[],script:[]};return _parse.default.parseFragment(e,{treeAdapter:_parse.default.treeAdapters.default,locationInfo:!0}).childNodes.forEach(function(r){t[r.nodeName]&&t[r.nodeName].push(_formatFragment(e,r))}),t}function parseFragmentsWithCache(e,t){return fragsCache.has(t)&&fragsCache.get(t).source===e||fragsCache.set(t,{source:e,frags:parseFragments(e)}),fragsCache.get(t).frags}function parseTemplate(e,t){return new Promise(function(r,a){_template.default.parse(e,t,function(e,t){if(e)a(e);else{var s=JSON.stringify(t.jsonTemplate,_utils.stringifyFunction,"  ");s=s.replace(_utils.FUNC_START_REG,"").replace(_utils.FUNC_END_REG,""),r({parsed:s,log:t.log})}})})}function parseStyle(e){return new Promise(function(t,r){_style.default.parse(e,function(e,a){var s=a.jsonStyle,n=a.depList,i=a.log;if(e)r(e);else{var o=JSON.stringify(s,null,2);t({parsed:o,depList:n,log:i})}})})}function parseScript(e){return new Promise(function(t,r){t({parsed:_script.default.fix(e)})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseFragmentsWithCache=parseFragmentsWithCache,exports.parseTemplate=parseTemplate,exports.parseStyle=parseStyle,exports.parseScript=parseScript;var _parse=_interopRequireDefault(require("parse5")),_template=_interopRequireDefault(require("./template")),_style=_interopRequireDefault(require("./style")),_script=_interopRequireDefault(require("./script")),_utils=require("../common/utils"),fragsCache=new Map;