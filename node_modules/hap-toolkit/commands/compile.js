"use strict";var webpack=require("webpack"),genWebpackConf=require("../tools/gen-webpack-conf"),_require=require("../tools/server/lib/utils"),colorconsole=_require.colorconsole;module.exports=function(e,o,r){function s(e,o){e&&colorconsole.error(e),o.hasErrors()&&o.compilation.errors.forEach(function(e){var o=e.message,r=/Can't resolve '(sass-loader|less-loader|stylus-loader)'/,s=r.exec(o);if("ModuleNotFoundError"===e.name&&s){var c=s[1];"less-loader"===c?c="less ".concat(c):"sass-loader"===c?c="node-sass ".concat(c):"stylus-loader"===c&&(c="stylus ".concat(c)),o+=" 缺少依赖: ".concat(c,", 请执行 `npm install -D ").concat(c,"` 安装相应依赖 ")}colorconsole.error(o)})}var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};process.env.NODE_PLATFORM=e,process.env.NODE_PHASE=o;var a="prod"===o?"production":"development",n=genWebpackConf(c,a);r?webpack(n).watch({aggregateTimeout:300},s):webpack(n,s)};